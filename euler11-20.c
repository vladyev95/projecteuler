#include <stdio.h>
#include <stdlib.h>


/* Problem 11 */ static char* str_grid = "";
/*"08 02 22 97 38 15 00 40 00 75 04 05 07 78 52 12 50 77 91 08 "
"49 49 99 40 17 81 18 57 60 87 17 40 98 43 69 48 04 56 62 00 "
"81 49 31 73 55 79 14 29 93 71 40 67 53 88 30 03 49 13 36 65 "
"52 70 95 23 04 60 11 42 69 24 68 56 01 32 56 71 37 02 36 91 "
"22 31 16 71 51 67 63 89 41 92 36 54 22 40 40 28 66 33 13 80 "
"24 47 32 60 99 03 45 02 44 75 33 53 78 36 84 20 35 17 12 50 "
"32 98 81 28 64 23 67 10 26 38 40 67 59 54 70 66 18 38 64 70 "
"67 26 20 68 02 62 12 20 95 63 94 39 63 08 40 91 66 49 94 21 "
"24 55 58 05 66 73 99 26 97 17 78 78 96 83 14 88 34 89 63 72 "
"21 36 23 09 75 00 76 44 20 45 35 14 00 61 33 97 34 31 33 95 "
"78 17 53 28 22 75 31 67 15 94 03 80 04 62 16 14 09 53 56 92 "
"16 39 05 42 96 35 31 47 55 58 88 24 00 17 54 24 36 29 85 57 "
"86 56 00 48 35 71 89 07 05 44 44 37 44 60 21 58 51 54 17 58 "
"19 80 81 68 05 94 47 69 28 73 92 13 86 52 17 77 04 89 55 40 "
"04 52 08 83 97 35 99 16 07 97 57 32 16 26 26 79 33 27 98 66 "
"88 36 68 87 57 62 20 72 03 46 33 67 46 55 12 32 63 93 53 69 "
"04 42 16 73 38 25 39 11 24 94 72 18 08 46 29 32 40 62 76 36 "
"20 69 36 41 72 30 23 88 34 62 99 69 82 67 59 85 74 04 36 16 "
"20 73 35 29 78 31 90 01 74 31 49 71 48 86 81 16 23 57 05 54 "
"01 70 54 71 83 51 54 69 16 92 33 48 61 43 52 01 89 19 67 48 \0"; */ 
/* Problem 11 */ char** strgrid_to_intarr(void);
/* Problem 11 */ int char_to_int(char* c);
/* Problem 11 */ int get_nth_num(short n);
/* Problem 11 */ int downwards_product(char** int_arr, char row, char col);
/* Problem 11 */ int rightwards_product(char** int_arr, char row, char col);
/* Problem 11 */ int majordiag_product(char** int_arr, char row, char col);
/* Problem 11 */ int minordiag_product(char** int_arr, char row, char col);
/* Problem 11 */ int largest_product(char** int_arr);

/* Problem 12 */ long nth_tri_num(long n);
/* Problem 12 */ short num_divisors(long n);
/* Problem 12 */ long n_500_divisors(void);

/* Problem 13 */ double arr[100] = { };
/* 37107287533902102798797998220837590246510135740250.0,
46376937677490009712648124896970078050417018260538.0,
74324986199524741059474233309513058123726617309629.0,
91942213363574161572522430563301811072406154908250.0,
23067588207539346171171980310421047513778063246676.0,
89261670696623633820136378418383684178734361726757.0,
28112879812849979408065481931592621691275889832738.0,
44274228917432520321923589422876796487670272189318.0,
47451445736001306439091167216856844588711603153276.0,
70386486105843025439939619828917593665686757934951.0,
62176457141856560629502157223196586755079324193331.0,
64906352462741904929101432445813822663347944758178.0,
92575867718337217661963751590579239728245598838407.0,
58203565325359399008402633568948830189458628227828.0,
80181199384826282014278194139940567587151170094390.0,
35398664372827112653829987240784473053190104293586.0,
86515506006295864861532075273371959191420517255829.0,
71693888707715466499115593487603532921714970056938.0,
54370070576826684624621495650076471787294438377604.0,
53282654108756828443191190634694037855217779295145.0,
36123272525000296071075082563815656710885258350721.0,
45876576172410976447339110607218265236877223636045.0,
17423706905851860660448207621209813287860733969412.0,
81142660418086830619328460811191061556940512689692.0,
51934325451728388641918047049293215058642563049483.0,
62467221648435076201727918039944693004732956340691.0,
15732444386908125794514089057706229429197107928209.0,
55037687525678773091862540744969844508330393682126.0,
18336384825330154686196124348767681297534375946515.0,
80386287592878490201521685554828717201219257766954.0,
78182833757993103614740356856449095527097864797581.0,
16726320100436897842553539920931837441497806860984.0,
48403098129077791799088218795327364475675590848030.0,
87086987551392711854517078544161852424320693150332.0,
59959406895756536782107074926966537676326235447210.0,
69793950679652694742597709739166693763042633987085.0,
41052684708299085211399427365734116182760315001271.0,
65378607361501080857009149939512557028198746004375.0,
35829035317434717326932123578154982629742552737307.0,
94953759765105305946966067683156574377167401875275.0,
88902802571733229619176668713819931811048770190271.0,
25267680276078003013678680992525463401061632866526.0,
36270218540497705585629946580636237993140746255962.0,
24074486908231174977792365466257246923322810917141.0,
91430288197103288597806669760892938638285025333403.0,
34413065578016127815921815005561868836468420090470.0,
23053081172816430487623791969842487255036638784583.0,
11487696932154902810424020138335124462181441773470.0,
63783299490636259666498587618221225225512486764533.0,
67720186971698544312419572409913959008952310058822.0,
95548255300263520781532296796249481641953868218774.0,
76085327132285723110424803456124867697064507995236.0,
37774242535411291684276865538926205024910326572967.0,
23701913275725675285653248258265463092207058596522.0,
29798860272258331913126375147341994889534765745501.0,
18495701454879288984856827726077713721403798879715.0,
38298203783031473527721580348144513491373226651381.0,
34829543829199918180278916522431027392251122869539.0,
40957953066405232632538044100059654939159879593635.0,
29746152185502371307642255121183693803580388584903.0,
41698116222072977186158236678424689157993532961922.0,
62467957194401269043877107275048102390895523597457.0,
23189706772547915061505504953922979530901129967519.0,
86188088225875314529584099251203829009407770775672.0,
11306739708304724483816533873502340845647058077308.0,
82959174767140363198008187129011875491310547126581.0,
97623331044818386269515456334926366572897563400500.0,
42846280183517070527831839425882145521227251250327.0,
55121603546981200581762165212827652751691296897789.0,
32238195734329339946437501907836945765883352399886.0,
75506164965184775180738168837861091527357929701337.0,
62177842752192623401942399639168044983993173312731.0,
32924185707147349566916674687634660915035914677504.0,
99518671430235219628894890102423325116913619626622.0,
73267460800591547471830798392868535206946944540724.0,
76841822524674417161514036427982273348055556214818.0,
97142617910342598647204516893989422179826088076852.0,
87783646182799346313767754307809363333018982642090.0,
10848802521674670883215120185883543223812876952786.0,
71329612474782464538636993009049310363619763878039.0,
62184073572399794223406235393808339651327408011116.0,
66627891981488087797941876876144230030984490851411.0,
60661826293682836764744779239180335110989069790714.0,
85786944089552990653640447425576083659976645795096.0,
66024396409905389607120198219976047599490197230297.0,
64913982680032973156037120041377903785566085089252.0,
16730939319872750275468906903707539413042652315011.0,
94809377245048795150954100921645863754710598436791.0,
78639167021187492431995700641917969777599028300699.0,
15368713711936614952811305876380278410754449733078.0,
40789923115535562561142322423255033685442488917353.0,
44889911501440648020369068063960672322193204149535.0,
41503128880339536053299340368006977710650566631954.0,
81234880673210146739058568557934581403627822703280.0,
82616570773948327592232845941706525094512325230608.0,
22918802058777319719839450180888072429661980811197.0,
77158542502016545090413245809786882778948721859617.0,
72107838435069186155435662884062257473692284509516.0,
20849603980134001723930671666823555245252804609722.0,
53503534226472524250874054075591789781264330331690.0}; */
/* Problem 13 */ double sum_large_nums(void);

/* Problem 14 */ long collatz_num(long n);
/* Problem 14 */ long longest_collatz(void);

/* Problem 15 */ long num_paths(unsigned char row, unsigned char col);

int main(void) {
	/* char** int_arr = strgrid_to_intarr();
	printf("%d", largest_product(int_arr));
	for(int i=0; i<20; i++) {
		free(*(int_arr+i));
	}
	free(int_arr); 
	
	printf("First triangle number with 500 divisors: %ld\n", n_500_divisors());
	

	printf("Sum of large numbers: %.0lf\n", sum_large_nums()); 
	
	printf("Longest collatz chain for a number under 1mil is caused by %ld\n", 
		longest_collatz());
		
	printf("Number of paths from top left 20x20 to bottom right: %ld", num_paths(0, 0));
	*/ 

	


	return 0;
}

int largest_product(char** int_arr) {
	int max = 0;
	int down, right, maj, min;
	for(char i=0; i<20; i++) {
		for(char j=0; j<20; j++) {
			down = downwards_product(int_arr, i, j);
			right = rightwards_product(int_arr, i, j);
			maj = majordiag_product(int_arr, i, j);
			min = minordiag_product(int_arr, i, j);
			if(down > max) max = down;
			if(right > max) max = right;
			if(maj > max) max = maj;
			if(min > max) max = min;
		}
	}
	return max;
}

char** strgrid_to_intarr(void) {
	char** rows = malloc(sizeof(char*) * 20);
	for(char i=0; i<20; i++) {
		*(rows+i) = malloc(sizeof(char) * 20);
	}

	for(short n=0; n<400; n++) {
		char row = n / 20;
		char col = n % 20;
		*(*(rows+row) + col) = get_nth_num(n);
	}
	return rows;
}	

int char_to_int(char* c) {
	int result = 0;
	result += (10 * (*c-48));
	result += (*(c+1) - 48);
	return result;
}

int get_nth_num(short n) {
	char* nthchar = str_grid + n*3;
	return char_to_int(nthchar);
}


int downwards_product(char** arr, char row, char col) {
	if(row + 3 > 19 || col > 19 || row < 0 || col < 0) {
		return 0;
	} else {
		return *(*(arr+row)+col) * 
		*(*(arr+row+1)+col) * 
		*(*(arr+row+2)+col) * 
		*(*(arr+row+3)+col);
	}
}

int rightwards_product(char** arr, char row, char col) {
	if(col + 3 > 19 || row > 19 || row < 0 || col < 0) {
		return 0;
	} else {
		return *(*(arr+row)+col) * 
		*(*(arr+row)+col+1) * 
		*(*(arr+row)+col+2) * 
		*(*(arr+row)+col+3);
	}
}

int majordiag_product(char** arr, char row, char col) {
	if(col + 3 > 19 || row + 3 > 19 || row < 0 || col < 0) {
		return 0;
	} else {
		return *(*(arr+row)+col) * 
		*(*(arr+row+1)+col+1) * 
		*(*(arr+row+2)+col+2) * 
		*(*(arr+row+3)+col+3);
	}
}

int minordiag_product(char** arr, char row, char col) {
	if(row - 3 < 0 || row > 19 || col + 3 > 19 || col < 0) {
		return 0;
	} else {
		return *(*(arr+row)+col) * 
		*(*(arr+row-1)+col+1) * 
		*(*(arr+row-2)+col+2) * 
		*(*(arr+row-3)+col+3);
	}
}





long nth_tri_num(long n) {
	long sum = 0;
	for(int i=1; i<=n; i++) {
		sum += i;
	}
	return sum;
}


short num_divisors(long n) {
	short divisors = 0;
	for(long i=1; i*i<n; i++) {
		if(n % i == 0) {
			if( i*i < n) {
				divisors += 2;
			} else {
				divisors += 1;
			}
		}
	}
	return divisors;
}

long n_500_divisors(void) {
	for(long i=1; ; i++) {
		long nth_tri = nth_tri_num(i);
		if(num_divisors(nth_tri) > 500) {
			return nth_tri;
		} 
	}
	return -1;
}





double sum_large_nums(void) {
	double sum = 0;
	for(unsigned char i=0; i<100; i++) {
		sum += arr[i];
	}
	return sum;
}







long collatz_num(long n) {
	long counter = 1;
	while(n != 1) {
		if(n % 2 == 0) {
			n = n/2;
		} else {
			n = 3*n + 1;
		}
		counter++;
	}
	return counter;
}

long longest_collatz(void) {
	long max = 0;
	int current = 0;
	for(int i = 1000000; i > 1; i--) {
		int collatz = collatz_num(i);
		if(collatz > max) {
			max = collatz;
			current = i;
		}
	}
	return current;
}




//Recursive method much too slow for 20x20 grid, works well for 16x16 and under
//Used the formula (2n)! / (n!)^2 to calculate answer
long num_paths(unsigned char row, unsigned char col) {
	if(row == 19 || col == 19) {
		return 1;
	}
	return num_paths(row+1, col) + num_paths(row, col+1);
}